<!DOCTYPE HTML>
<html lang="ko" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>메모리 계층 - Be_Software_Engineer</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../../introduction/index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../../../dataStructure_and_algorithm/introduction.html"><strong aria-hidden="true">2.</strong> Data Structure and Algorithm</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../dataStructure_and_algorithm/final/bigO.html"><strong aria-hidden="true">2.1.</strong> BigO</a></li><li class="chapter-item expanded "><a href="../../../dataStructure_and_algorithm/final/array.html"><strong aria-hidden="true">2.2.</strong> 배열</a></li><li class="chapter-item expanded "><a href="../../../dataStructure_and_algorithm/pocu/introduction.html"><strong aria-hidden="true">2.3.</strong> pocu 강의정리</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../dataStructure_and_algorithm/pocu/algorithm.html"><strong aria-hidden="true">2.3.1.</strong> 알고리즘의 정의와 효율성</a></li><li class="chapter-item expanded "><a href="../../../dataStructure_and_algorithm/pocu/bigO.html"><strong aria-hidden="true">2.3.2.</strong> 빅오표기법</a></li><li class="chapter-item expanded "><a href="../../../dataStructure_and_algorithm/pocu/array.html"><strong aria-hidden="true">2.3.3.</strong> 배열</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../../java/introduction.html"><strong aria-hidden="true">3.</strong> Java</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../java/pocu/1.html"><strong aria-hidden="true">3.1.</strong> pocu 강의 정리</a></li><li class="chapter-item expanded "><a href="../../../java/books/1/basic.html"><strong aria-hidden="true">3.2.</strong> 자바의 신</a></li></ol></li><li class="chapter-item expanded "><a href="../../../javascript/introduction.html"><strong aria-hidden="true">4.</strong> Javascript</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../javascript/var.html"><strong aria-hidden="true">4.1.</strong> var</a></li><li class="chapter-item expanded "><a href="../../../javascript/data.html"><strong aria-hidden="true">4.2.</strong> data</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../javascript/data/array.html"><strong aria-hidden="true">4.2.1.</strong> array</a></li><li class="chapter-item expanded "><a href="../../../javascript/data/collection.html"><strong aria-hidden="true">4.2.2.</strong> collection</a></li><li class="chapter-item expanded "><a href="../../../javascript/data/date.html"><strong aria-hidden="true">4.2.3.</strong> date</a></li><li class="chapter-item expanded "><a href="../../../javascript/data/math.html"><strong aria-hidden="true">4.2.4.</strong> math</a></li><li class="chapter-item expanded "><a href="../../../javascript/data/number.html"><strong aria-hidden="true">4.2.5.</strong> number</a></li><li class="chapter-item expanded "><a href="../../../javascript/data/String.html"><strong aria-hidden="true">4.2.6.</strong> string</a></li></ol></li><li class="chapter-item expanded "><a href="../../../javascript/hoisting.html"><strong aria-hidden="true">4.3.</strong> hosting</a></li><li class="chapter-item expanded "><a href="../../../javascript/json.html"><strong aria-hidden="true">4.4.</strong> json</a></li><li class="chapter-item expanded "><a href="../../../javascript/scope.html"><strong aria-hidden="true">4.5.</strong> scope</a></li></ol></li><li class="chapter-item expanded "><a href="../../../linux/introduction.html"><strong aria-hidden="true">5.</strong> Linux</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../linux/books/1/introduction.html"><strong aria-hidden="true">5.1.</strong> 실습과 그림으로 배우는 리눅스 구조</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../linux/books/1/chapter1.html"><strong aria-hidden="true">5.1.1.</strong> 컴퓨터 시스템의 개요</a></li><li class="chapter-item expanded "><a href="../../../linux/books/1/chapter2.html"><strong aria-hidden="true">5.1.2.</strong> 사용자 모드로 구현되는 기능</a></li><li class="chapter-item expanded "><a href="../../../linux/books/1/chapter3.html"><strong aria-hidden="true">5.1.3.</strong> 프로세스 관리</a></li><li class="chapter-item expanded "><a href="../../../linux/books/1/chapter4.html"><strong aria-hidden="true">5.1.4.</strong> 프로세스 스케줄러</a></li><li class="chapter-item expanded "><a href="../../../linux/books/1/chapter5.html"><strong aria-hidden="true">5.1.5.</strong> 메모리 관리</a></li><li class="chapter-item expanded "><a href="../../../linux/books/1/chapter6.html" class="active"><strong aria-hidden="true">5.1.6.</strong> 메모리 계층</a></li><li class="chapter-item expanded "><a href="../../../linux/books/1/chapter7.html"><strong aria-hidden="true">5.1.7.</strong> 파일 시스템</a></li><li class="chapter-item expanded "><a href="../../../linux/books/1/chapter8.html"><strong aria-hidden="true">5.1.8.</strong> 저장 장치</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Be_Software_Engineer</h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="메모리-계층"><a class="header" href="#메모리-계층">메모리 계층</a></h1>
<p>메모리 장치의 계층 구조를 도식화한 그림</p>
<p>레지스터<br />
캐시 메모리
메모리
저장 장치</p>
<p>아래부터 위</p>
<ul>
<li>사이즈 큼 -&gt; 작음</li>
<li>가격 쌈 -&gt; 비쌈</li>
<li>접근속도 느림 -&gt; 빠름</li>
</ul>
<h2 id="캐시-메모리"><a class="header" href="#캐시-메모리">캐시 메모리</a></h2>
<p>컴퓨터의 동작흐름은 아래와 같다</p>
<ol>
<li>명령어를 바탕으로 메모리에서 레지스터로 데이터를 읽는다.</li>
<li>레지스터에 있는 데이터를 바탕으로 계산한다.</li>
<li>계산 결과를 메모리에 쓴다.</li>
</ol>
<p>캐시 메모리는 레지스터 안에서 계산하는 것과 메모리에 접근하는 것, 양쪽의 처리 시간의 차이를 메우는 역할을 한다.</p>
<p>캐시 메모리로부터 레지스터에 접근할 때의 레이턴시는 메모리에 접근할 때와 비교해보면 수배에서 수십배 빠른 점을 이용해 속도를 고속화한다. 캐시 메모리는 일반적으로 CPU에 내장되어 있지만 CPU의 바깥에 있는 캐시 메모리도 있다.</p>
<p>메모리에서 레지스터로 데이터를 읽어올 때는, 일단 캐시 메모리에 읽어온 뒤 같은 내용을 다시 레지스터로 읽어들인다. 이때 읽어오는 크기는 CPU에서 정한 '캐시 라인 사이즈'만큼이다.</p>
<p>메모리로부터 읽어 들인 데이터가 변경되었음을 플래그로 표시하는 데 이 표시된 라인을 '더티'라고 한다.
이 더티 플래그가 붙어 있는 데이터는 나중에 백그라운드 처리로 메모리에 다시 기록된다. 다시 기록되면 더티 플래그는 사라진다.</p>
<h3 id="캐시-메모리가-가득-찬-경우"><a class="header" href="#캐시-메모리가-가득-찬-경우">캐시 메모리가 가득 찬 경우</a></h3>
<p>캐시 메모리가 가득 찬 경우, 캐시 메모리에 존재하지 않는 데이터를 추가로 읽으면 기존의 캐시 메모리 중 1개를 파기한다. 파기되어 비워진 라인에 새 데이터를 넣는다.</p>
<p>캐시 메모리가 가득 차고 모든 캐시 라인이 더티라면 메모리 접근을 할 때마다 캐시 라인 안의 데이터가 자주 바뀌는 스래싱이 발생하여 성능이 크게 감속할 수 있다.</p>
<h3 id="메모리-참조의-국소성"><a class="header" href="#메모리-참조의-국소성">메모리 참조의 국소성</a></h3>
<p>(국소성: 충분히 멀리 떨어진 두 물체는 곧바로 상용하지 않는다는 원리)</p>
<p>프로세스의 데이터가 전부 캐시에 있는 동안에는 데이터에 접근하는 속도는 메모리에 접근하는 속도가 아니라 이보다 빠른 캐시에 접근하는 속도이다. 프로그램은 대부분 메모리 참조의 국소성이라고 하는 다음과 같은 특성이 있다.</p>
<ul>
<li>시간 국소성: 특정 시점에서 접근하는 데이터는 가까운 미래에 다시 접근할 가능성이 크다. 전형적인 예로는 루프 처리중인 코드 영역을 들 수 있다.</li>
<li>공간 국소성: 특정 시점에 어떤 데이터에 접근하면 그 데이터와 가까운 주소에 있는 데이터를 접근할 확률이 높다. 전형적인 예로는 배열의 전체 검색 등을 들 수 있다.</li>
</ul>
<p>이러한 이유로 프로세스는 짧은 시간을 놓고 생각해보면, 자신이 획득한 메모리의 총량보다 훨씬 좁은 범위의 메모리에 접근하는 성향이 있다. 이 좁은 범위를 캐시 메모리의 사이즈가 커버할 수 있으면 성능이 좋은 것이다.</p>
<h3 id="정리"><a class="header" href="#정리">정리</a></h3>
<p>프로그램의 워크로드를 캐시 메모리 사이즈에 들어가게 하는 것으로 성능을 크게 향상시킬 수 있다.
속도를 중요시하는 프로그램이라면 캐시 메모리의 효과를 최대한으로 끌어내기 위해 데이터의 배열이나 알고리즘 혹은 설정을 연구해서 단위 시간 당 메모리 접근 범위를 작게 하는 것이 중요하다.</p>
<p>한편, 시스템 설정을 변경했을 때 프로그램의 성능이 크게 나빠진 경우에는 프로그램의 데이터가 캐시 메모리에 전부 들어가지 않았을 가능성이 있다.</p>
<h2 id="translation-lookaside-buffer"><a class="header" href="#translation-lookaside-buffer">Translation Lookaside Buffer</a></h2>
<p>프로세스는 다음과 같은 순서에 따라 가상 주소의 데이터에 접근한다.</p>
<ol>
<li>물리 메모리상에 존재하는 페이지 테이블을 참고하여 가상 주소를 물리 주소로 변환한다.</li>
<li>1에서 구한 물리 메모리에 접근한다.</li>
</ol>
<p>캐시 메모리를 사용하여 고속화하는 것은 2번뿐이다. 왜냐하면 1은 물리 메모리상에 있는 페이지 테이블에 접근해야 하므로 캐시가 동작할 수 없다.</p>
<p>이 문제를 해결하기 위해 CPU에는 가상 주소에서 물리 주소로의 변환표를 보관하는 한편, 캐시 메모리와 똑같이 고속으로 접근 가능한 TLB 라는 영역이 있다. 이것을 가지고 1을 고속화 한다.</p>
<h3 id="페이지-캐시"><a class="header" href="#페이지-캐시">페이지 캐시</a></h3>
<p>CPU로부터 메모리에 접근하는 속도에 비해 저장 장치에 접근하는 속도는 엄청나게 느리다.
이 속도 차이를 줄이기 위해 커널에는 '페이지 캐시'기능이 있다.</p>
<p>페이지 캐시는 캐시 메모리와 매우 비슷하다
캐시 메모리가 메모리의 데이터를 캐싱하느 ㄴ것과 비슷하게 페이지 캐시는 저장 장치 내의 파일 데이터를 메모리에 캐싱한 것이다.</p>
<p>캐시 메모리는 캐시 라인 단위로 데이터를 다루지만 페이지 캐시는 페이지 단위로 데이터를 다룬다.
페이지 캐시의 동작 흐름을 구체적으로 살펴본다.</p>
<p>프로세스가 파일의 데이터를 읽어 들이면 커널은 프로세스의 메모리에 파일의 데이터를 직접 복사하는 것이 아니라 커널의 메모리 내에 있는 페이지 캐시라는 영역에 복사한 뒤 이 데이터를 프로세스 메모리에 복사한다.</p>
<p>커널은 자신의 메모리 안에 페이지 캐시에 캐싱한 파일과 그 범위 등의 정보를 보관하는 관리 영역을 가지고 있다.</p>
<p>그리고 페이지 캐시에 존재하는 데이터를 다시 읽으면 커널은 페이지 캐시의 데이터를 돌려준다.</p>
<p>이 방법은 저장 장치에 접근하는 경우에 비해 훨씬 더 빠르게 처리된다.
또한 페이지 캐시는 전체 프로세스 공유의 자원이므로 읽어 들인 프로세스는 최초에 파일 데이터에 접근한 프로세스와 다른 프로세스여도 문제가 없다.</p>
<h3 id="페이지-캐시-쓰기"><a class="header" href="#페이지-캐시-쓰기">페이지 캐시 쓰기</a></h3>
<p>프로세스가 데이터를 파일에 쓰면 커널은 페이지 캐시에 데이터를 쓴다.
이때 관리 영역 내에 해당하는 데이터에 대응되는 엔트리에 '데이터의 내용은 저장 장치의 내용보다 새로운 것'이라는 플래그를 붙여둔다. 이 플래그가 붙은 페이지를 더티 페이지라고 부른다.</p>
<p>이것도 읽기와 마찬가지로 저장 장치에 접근하는 것에 비해 훨씬 더 빠르게 처리된다.
더티 페이지의 내용은 나중에 커널의 백그라운드로 처리하며 스토리지 내의 파일에 반영한다.
이때 더티 페이지의 플래그를 지운다.</p>
<p>각 프로세스가 접근하는 파일의 데이터가 전부 페이지 캐시에 있으면 시스템 파일의 접근 속도는 저장 장치의 접근 속도가 아닌 메모리 접근 속도에 근접하므로 시스템 전체가 빠르게 동작한다.</p>
<p>또한 페이지 캐시 사이즈는 시스템의 메모리가 비어 있는 한, 시스템 내의 각 프로세스가 페이지 캐시에 없는 파일을 읽을 때마다 점점 증가한다.</p>
<p>시스템 메모리가 부족해지면 커널은 페이지 캐시를 해제하여 빈 영역을 만든다. 이 경우 더티가 아닌 페이지를 파기한다. 그래도 시스템 메모리가 부족하면 더티 페이지를 라이트 백 한 뒤에 파기한다.
더티 페이지는 저장 장치 접근이 발생하므로 시스템의 성능이 느려지는 문제점이 있다. 파일에 쓰기가 많아서 더티 페이지가 많아지는 시스템은 부하가 많아질 수 밖에 없다. 메모리 부족이 더티 페이지의 라이트 백을 자주 발생시켜 시스템이 느려지는 일은 굉장히 자주 있다.</p>
<h2 id="버퍼-캐시"><a class="header" href="#버퍼-캐시">버퍼 캐시</a></h2>
<p>페이지 캐시와 비슷한 구조로 버퍼 캐시라는 것이 있다.
이것은 파일시스템을 사용하지 않고 나중에 설명할 디바이스 파일을 이용하여 저장 장치에 직접 접근하는 등의 목적으로 사용한다.</p>
<p>페이지 캐시와 버퍼 캐시를 합쳐서 저장 장치 안의 데이터를 메모리에 넣어두는 방식이라 한다.</p>
<h2 id="정리-1"><a class="header" href="#정리-1">정리</a></h2>
<p>파일의 데이터가 페이지 캐시에 있다면 없는 경우와 비교해서 파일 접근이 매우 빨라진다.
그렇게 하기 위해서는 시스템이 접근하는 파일의 사이즈나 물리 메모리의 양을 비교하여 맞추는 것이 중요하다.</p>
<p>설정 변경이나 시간이 지나면서 시스템의 성능이 갑자기 느려졌다면 파일의 데이터가 페이지 캐시에 제대로 들어가지 못했을 수 있다. 여러가지 sysctl 파라미터를 잘 튜닝한다면 페이지 캐시의 라이트 백이 자주 발생하여서 생기는 I/O 부하를 막을 수 있다. 또한 sar - B나 sar -d -p등을 이용하여 페이지 캐시에 관한 통계 정보를 얻을 수 있다.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../linux/books/1/chapter5.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../../linux/books/1/chapter7.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../linux/books/1/chapter5.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../../linux/books/1/chapter7.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
