# 프로세스 관리

## 프로세스 생성의 목적

리눅스에서는 두 가지 목적으로 프로세스를 생성한다.

1. 같은 프로그램의 처리를 여러 개의 프로세스가 나눠서 처리한다. 예를 들어 웹 서버처럼 리퀘스트가 여러 개 들어왔을 때 동시에 처리해야 하는 경우
2. 전혀 다른 프로그램을 생성합니다. 예를 들어 bash로부터 각종 프로그램을 새로 생성하는 경우


### fork() 함수

목적1을 수행하는 함수이다.
fork 함수를 실행하면 실행한 프로세스와 함께 새로운 프로세스가 1개가 커널 메모리로부터 생성된다.
생성 전의 프로세스를 부모 프로세스(parent process), 새롭게 생성된 프로세스를 자식 프로세스(child process)라고 부릅니다.

1. 자식 프로세스용 메모리 영역을 작성하고 거기에 부모 프로세스의 메모리를 복사한다
2. fork 함수의 리턴 값이 각기 다른 것을 이용하며 부모 프로세스와 자식 프로세스가 서로 다른 코드를 실행하도록 분기한다.

### execve() 함수

전혀 다른 프로그램을 생성할 때에는 execve() 함수를 사용한다.

1. 실행 파일을 읽은 다음 프로세스의 메모리 맵에 필요한 정보를 읽어들인다.
2. 현재 프로세스의 메모리를 새로운 프로세스의 데이터로 덮어쓴다.
3. 새로운 프로세스의 첫 번째 명령부터 실행한다.

즉, 전혀 다른 프로그램을 생성하는 경우 프로세스의 수가 증가하는 것이 아니라 기존의 프로세스를 별도의 프로세스로 변경하는 방식으로 수행된다.
리눅스의 실행 파일은 실제로는 위에서 설명한 것 같은 단순한 것이 아니라 'ELF Executable and Linkable Format'라는 형식을 사용한다.
ELF 형식의 각종 정보는 'readelf' 명령어로 자세히 볼 수 있다.

```

$ readelf -h /bin/sleep

# readelf : ELF 형식의 각종 정보를 출력하는 명령어

```

### fork and exec 방식

bash 에서 echo를 실행하는 과정

1. bash 메모리를 기준으로 fork()를 통해 자식 프로세스를 생성
2. 자식 프로세스를 다른 프로그램으로 대체하기 위해 exec() 실행
3. echo의 메모리가 되어 echo 프로그램을 실행

### _exit()

프로그램 종료는 '_exit()'함수를 사용한다.
( 내부에서는 exit_group() 시스템 콜을 호출한다 )
이 함수를 이용하면 할당된 메모리를 전부 회수한다.

